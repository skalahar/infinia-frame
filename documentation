#Increase swap size
Edit /etc/dphys-swapfile (e.g. sudo vim /etc/dphys-swapfile) and change the value of CONF_SWAPSIZE to 1024. You might be able to get away with a smaller swap size but it's been reported that the build process stalls with a swap size of 256.

Then restart swap with sudo /etc/init.d/dphys-swapfile restart

#Install system applications
sudo apt-get update
sudo apt-get upgrade
sudo apt-get -y install tmux vim
sudo apt-get -y install cmake
sudo apt-get -y install python3-dev python3-venv python3-pip
sudo apt-get -y install imagemagick
sudo apt-get -y install git git-lfs
sudo apt-get -y install libopencv-dev  python3-opencv

#clone the repository
git clone https://github.com/skalahar/infinia-frame.git

#create a virtual env.
cd /home/infinia/infinia-frame
python3 -m venv .venv
source .venv/bin/activate

#Install python libraries
python -m pip install opencv_contrib_python
python -m pip install inky[rpi]==1.5.0
python -m pip install pillow
python -m pip install flask
python -m pip install flask-socketio

#clone and build the XNNPACK repo
# Following instructions taken directly from [OnnxStream repo](https://github.com/vitoplantamura/OnnxStream).
cd /home/infinia/infinia-frame
git clone https://github.com/google/XNNPACK.git
cd XNNPACK
git checkout 1c8ee1b68f3a3e0847ec3c53c186c5909fa3fbd3
mkdir build
cd build
cmake -DXNNPACK_BUILD_TESTS=OFF -DXNNPACK_BUILD_BENCHMARKS=OFF ..
cmake --build . --config Release

#Clone and build the OnnxStream repo
cd /home/infinia/infinia-frame
git clone https://github.com/vitoplantamura/OnnxStream.git
cd OnnxStream
cd src
mkdir build
cd build
cmake -DMAX_SPEED=ON -DOS_LLM=OFF -DOS_CUDA=OFF -DXNNPACK_DIR=/home/skalahar/infinia-frame/XNNPACK ..
cmake --build . --config Release

#Clone the model
cd /home/infinia/infinia-frame
mkdir models
cd models
git clone --depth=1 https://huggingface.co/vitoplantamura/stable-diffusion-xl-turbo-1.0-anyshape-onnxstream

#Creating a new User and give it admin privileges
sudo adduser username
sudo usermod -aG sudo username

sudo mv /home/user1/ /home/user2/ # move files from one user to another

sudo chown -R user2:user2 /home/user2/ # Change permissions to the new user

#Adding a new ssh for github
ssh-keygen -t ed25519 -C "your_email@example.com"
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_ed25519
cat ~/.ssh/id_ed25519.pub
